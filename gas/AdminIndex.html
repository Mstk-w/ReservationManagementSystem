<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <style>
    /* =========================== */
    /* åŸºæœ¬è¨­å®šã¨ãƒªã‚»ãƒƒãƒˆ */
    /* =========================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Georgia', 'Times New Roman', serif;
      background: linear-gradient(135deg, #f7f1e8 0%, #e8dcc6 50%, #d3aa43 100%);
      min-height: 100vh;
      color: #3c2e26;
      line-height: 1.6;
    }

    /* =========================== */
    /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ã‚³ãƒ³ãƒ†ãƒŠ */
    /* =========================== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      color: #3c2e26;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.8rem;
      text-shadow: 0 2px 4px rgba(60, 46, 38, 0.1);
      font-weight: 400;
      letter-spacing: 2px;
    }

    /* =========================== */
    /* ã‚«ãƒ¼ãƒ‰å‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    /* =========================== */
    .card {
      background: linear-gradient(145deg, #ffffff 0%, #faf8f5 100%);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(60, 46, 38, 0.08), 0 2px 8px rgba(211, 170, 67, 0.12);
      margin-bottom: 28px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(211, 170, 67, 0.15);
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 48px rgba(60, 46, 38, 0.12), 0 4px 16px rgba(211, 170, 67, 0.2);
    }

    .card-header {
      background: linear-gradient(135deg, #d3aa43 0%, #c49a3d 50%, #b8913a 100%);
      color: white;
      padding: 24px;
      font-size: 1.4rem;
      font-weight: 500;
      text-shadow: 0 1px 3px rgba(0,0,0,0.2);
      border-bottom: 2px solid rgba(255,255,255,0.1);
    }

    .card-body {
      padding: 28px;
      background: rgba(255,255,255,0.6);
    }

    /* =========================== */
    /* èªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    /* =========================== */
    #auth {
      max-width: 420px;
      margin: 120px auto;
    }

    #auth .card-body {
      text-align: center;
      background: rgba(255,255,255,0.9);
    }

    .auth-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      color: #d3aa43;
    }

    .form-group {
      margin-bottom: 24px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #3c2e26;
      font-weight: 600;
      font-size: 14px;
      letter-spacing: 0.5px;
    }

    input, select {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid rgba(211, 170, 67, 0.2);
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.9);
      color: #3c2e26;
      font-family: inherit;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #d3aa43;
      box-shadow: 0 0 0 4px rgba(211, 170, 67, 0.15);
      background: white;
    }

    input::placeholder {
      color: rgba(60, 46, 38, 0.5);
    }

    /* =========================== */
    /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
    /* =========================== */
    .btn {
      display: inline-block;
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      min-height: 48px;
      line-height: 1.4;
      letter-spacing: 0.5px;
      font-family: inherit;
    }

    .btn-primary {
      background: linear-gradient(135deg, #d3aa43 0%, #c49a3d 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(211, 170, 67, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(211, 170, 67, 0.4);
      background: linear-gradient(135deg, #e4bb54 0%, #d3aa43 100%);
    }

    .btn-success {
      background: linear-gradient(135deg, #8bc34a 0%, #7cb342 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(139, 195, 74, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(139, 195, 74, 0.4);
    }

    .btn-warning {
      background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(255, 152, 0, 0.3);
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 152, 0, 0.4);
    }

    .btn-danger {
      background: linear-gradient(135deg, #e57373 0%, #d32f2f 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(229, 115, 115, 0.3);
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(229, 115, 115, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(141, 110, 99, 0.3);
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(141, 110, 99, 0.4);
    }

    .btn-small {
      padding: 10px 20px;
      font-size: 12px;
      min-height: 40px;
    }

    /* =========================== */
    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ */
    /* =========================== */
    .statusbar {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      padding: 20px 24px;
      background: rgba(211, 170, 67, 0.08);
      border-radius: 12px;
      margin-bottom: 28px;
      font-size: 14px;
      border: 1px solid rgba(211, 170, 67, 0.15);
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }

    .pill {
      padding: 6px 16px;
      border-radius: 24px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid transparent;
      letter-spacing: 0.5px;
    }

    .pill.ok {
      background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%);
      color: #2e7d32;
      border-color: rgba(46, 125, 50, 0.3);
    }

    .pill.ng {
      background: linear-gradient(135deg, #ffcdd2 0%, #ef9a9a 100%);
      color: #c62828;
      border-color: rgba(198, 40, 40, 0.3);
    }

    .pill.neutral {
      background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);
      color: #0277bd;
      border-color: rgba(2, 119, 189, 0.3);
    }

    /* =========================== */
    /* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
    /* =========================== */
    .toast {
      margin-top: 20px;
      padding: 20px 24px;
      border-radius: 12px;
      display: none;
      font-weight: 500;
      border-left: 5px solid;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    .toast.ok {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      color: #2e7d32;
      border-left-color: #4caf50;
    }

    .toast.err {
      background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
      color: #c62828;
      border-left-color: #f44336;
    }

    /* =========================== */
    /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    /* =========================== */
    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .filter-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 24px;
    }

    .date-range-wrapper {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .date-separator {
      color: #d3aa43;
      font-weight: bold;
      font-size: 16px;
      margin: 0 4px;
    }

    /* =========================== */
    /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
    /* =========================== */
    .table-container {
      overflow-x: auto;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(60, 46, 38, 0.08);
      border: 1px solid rgba(211, 170, 67, 0.15);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      min-width: 800px;
    }

    th {
      background: linear-gradient(135deg, #d3aa43 0%, #c49a3d 100%);
      color: white;
      padding: 20px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    td {
      padding: 16px;
      border-bottom: 1px solid rgba(211, 170, 67, 0.1);
      font-size: 14px;
      color: #3c2e26;
    }

    tr:hover {
      background: rgba(211, 170, 67, 0.04);
    }

    .action-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* =========================== */
    /* å•†å“ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    /* =========================== */
    .products-table-container {
      overflow-x: auto;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(60, 46, 38, 0.06);
      border: 1px solid rgba(211, 170, 67, 0.15);
      margin-bottom: 20px;
    }

    .products-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      min-width: 800px;
    }

    .products-table th {
      background: linear-gradient(135deg, #d3aa43 0%, #c49a3d 100%);
      color: white;
      padding: 16px 12px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
      border-bottom: 2px solid rgba(255,255,255,0.1);
    }

    .products-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(211, 170, 67, 0.08);
      font-size: 14px;
      color: #3c2e26;
      vertical-align: middle;
    }

    .products-table tr:hover {
      background: rgba(211, 170, 67, 0.03);
    }

    .products-table tr:last-child td {
      border-bottom: none;
    }

    .product-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid rgba(211, 170, 67, 0.2);
      border-radius: 6px;
      font-size: 13px;
      transition: all 0.2s ease;
      background: rgba(255,255,255,0.9);
      color: #3c2e26;
      font-family: inherit;
    }

    .product-input:focus {
      outline: none;
      border-color: #d3aa43;
      box-shadow: 0 0 0 2px rgba(211, 170, 67, 0.1);
      background: white;
    }

    .product-input[type="number"] {
      text-align: right;
    }

    .product-checkbox-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .product-checkbox {
      width: 16px;
      height: 16px;
      accent-color: #d3aa43;
    }

    .product-checkbox-label {
      font-size: 12px;
      color: #3c2e26;
      margin: 0;
      font-weight: 500;
    }

    .product-actions {
      display: flex;
      gap: 6px;
      justify-content: center;
      align-items: center;
    }

    .product-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 32px;
      letter-spacing: 0.3px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .product-btn-save {
      background: linear-gradient(135deg, #8bc34a 0%, #7cb342 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(139, 195, 74, 0.2);
    }

    .product-btn-save:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(139, 195, 74, 0.3);
    }

    .product-btn-delete {
      background: linear-gradient(135deg, #e57373 0%, #d32f2f 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(229, 115, 115, 0.2);
    }

    .product-btn-delete:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(229, 115, 115, 0.3);
    }

    /* =========================== */
    /* ä¼‘æ¥­æ—¥ç®¡ç† */
    /* =========================== */
    .holiday-form {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: end;
      margin-bottom: 24px;
    }

    .holiday-list {
      list-style: none;
    }

    .holiday-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: rgba(211, 170, 67, 0.04);
      border-radius: 12px;
      margin-bottom: 12px;
      border: 1px solid rgba(211, 170, 67, 0.15);
      transition: all 0.3s ease;
    }

    .holiday-item:hover {
      background: rgba(211, 170, 67, 0.08);
      transform: translateX(4px);
    }

    /* =========================== */
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    /* =========================== */
    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      h1 {
        font-size: 2.2rem;
        margin-bottom: 24px;
        letter-spacing: 1px;
      }

      .card-body {
        padding: 20px;
      }

      .statusbar {
        flex-direction: column;
        align-items: stretch;
      }

      .status-item {
        justify-content: space-between;
      }

      .filters {
        grid-template-columns: 1fr;
      }

      .filter-actions {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        text-align: center;
      }

      .product-item {
        grid-template-columns: 1fr;
        gap: 12px;
        text-align: center;
      }

      .product-actions {
        justify-content: center;
      }

      .products-table-container {
        border-radius: 0;
        margin: 0 -20px;
      }

      .products-table {
        min-width: 600px;
      }

      .products-table th,
      .products-table td {
        padding: 8px 6px;
        font-size: 12px;
      }

      .product-input {
        padding: 6px 8px;
        font-size: 12px;
      }

      .product-btn {
        padding: 4px 8px;
        font-size: 10px;
        min-height: 28px;
      }

      .product-checkbox-wrapper {
        flex-direction: column;
        gap: 2px;
      }

      .date-range-wrapper {
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
      }

      .date-separator {
        text-align: center;
        font-size: 14px;
      }

      .holiday-form {
        flex-direction: column;
        align-items: stretch;
      }

      .holiday-item {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .table-container {
        border-radius: 0;
        margin: 0 -20px;
      }

      table {
        min-width: 600px;
      }

      .action-buttons {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .card-header {
        padding: 20px;
        font-size: 1.2rem;
      }

      .card-body {
        padding: 16px;
      }

      th, td {
        padding: 12px 8px;
        font-size: 12px;
      }

      .btn-small {
        padding: 8px 16px;
        font-size: 11px;
      }
    }

    /* =========================== */
    /* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ */
    /* =========================== */
    .muted {
      color: rgba(60, 46, 38, 0.6);
      font-size: 12px;
      margin-top: 12px;
      font-style: italic;
      line-height: 1.5;
    }

    .text-center {
      text-align: center;
    }

    .hidden {
      display: none;
    }

    .mb-0 { margin-bottom: 0; }
    .mb-1 { margin-bottom: 8px; }
    .mb-2 { margin-bottom: 16px; }
    .mb-3 { margin-bottom: 24px; }

    .mt-0 { margin-top: 0; }
    .mt-1 { margin-top: 8px; }
    .mt-2 { margin-top: 16px; }
    .mt-3 { margin-top: 24px; }

    /* =========================== */
    /* ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å“è³ªã®æ”¹å–„ */
    /* =========================== */
    
    /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹çŠ¶æ…‹ã®çµ±ä¸€ */
    button:focus,
    input:focus,
    select:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(211, 170, 67, 0.2);
    }

    /* ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š */
    button:focus-visible,
    input:focus-visible,
    select:focus-visible {
      outline: 2px solid #d3aa43;
      outline-offset: 2px;
    }

    /* ãƒ›ãƒãƒ¼çŠ¶æ…‹ã®çµ±ä¸€ */
    .card:hover {
      transform: translateY(-3px);
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã®è¦‹ãŸç›®æ”¹å–„ */
    ::selection {
      background: rgba(211, 170, 67, 0.3);
      color: #3c2e26;
    }

    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
    .table-container::-webkit-scrollbar,
    .products-table-container::-webkit-scrollbar {
      height: 8px;
    }

    .table-container::-webkit-scrollbar-track,
    .products-table-container::-webkit-scrollbar-track {
      background: rgba(211, 170, 67, 0.1);
      border-radius: 4px;
    }

    .table-container::-webkit-scrollbar-thumb,
    .products-table-container::-webkit-scrollbar-thumb {
      background: rgba(211, 170, 67, 0.3);
      border-radius: 4px;
    }

    .table-container::-webkit-scrollbar-thumb:hover,
    .products-table-container::-webkit-scrollbar-thumb:hover {
      background: rgba(211, 170, 67, 0.5);
    }

    /* ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ */
    .btn:active,
    .product-btn:active {
      transform: translateY(0px) scale(0.98);
    }

    /* èª­ã¿è¾¼ã¿çŠ¶æ…‹ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ */
    .loading-shimmer {
      background: linear-gradient(90deg, 
        rgba(211, 170, 67, 0.1) 25%, 
        rgba(211, 170, 67, 0.2) 50%, 
        rgba(211, 170, 67, 0.1) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* =========================== */
    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    /* =========================== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .card {
      animation: fadeIn 0.4s ease-out;
    }

    .toast {
      animation: slideIn 0.3s ease-out;
    }

    /* =========================== */
    /* ç‰¹æ®ŠåŠ¹æœ */
    /* =========================== */
    .countryside-texture {
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(211, 170, 67, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(139, 195, 74, 0.05) 0%, transparent 50%);
    }

    code {
      background: rgba(211, 170, 67, 0.1);
      padding: 2px 8px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      color: #3c2e26;
      font-size: 12px;
    }
  </style>
</head>
<body class="countryside-texture">
  <div class="container">
    <h1>ğŸŒ¾ ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

    <!-- ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="auth" class="card">
      <div class="card-header text-center">
        ğŸ” ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
      </div>
      <div class="card-body">
        <div class="auth-icon text-center">ğŸ¡</div>
        <div class="form-group">
          <label for="email">ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input id="email" type="email" placeholder="admin@example.com">
        </div>
        <div class="form-group">
          <label for="pass">ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input id="pass" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
        </div>
        <button id="login" class="btn btn-primary" style="width: 100%;">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <div class="muted mt-2">
          â€» Firebase Authenticationï¼ˆEmail/Passwordï¼‰ãŒæœ‰åŠ¹ã§ã€è¨±å¯æ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ã« <code>script.googleusercontent.com</code> ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
        </div>
      </div>
    </section>

    <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“ -->
    <section id="app" class="hidden">
      <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
      <div class="card">
        <div class="card-body">
          <div class="statusbar">
            <div class="status-item">
              <span>ğŸ—ï¸ Project:</span>
              <code id="pid">-</code>
            </div>
            <div class="status-item">
              <span>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼:</span>
              <code id="uemail">-</code>
            </div>
            <div class="status-item">
              <span>ğŸ”‘ ç®¡ç†æ¨©é™:</span>
              <span id="adminPill" class="pill neutral">ç¢ºèªä¸­...</span>
            </div>
            <div class="status-item">
              <button id="signout" class="btn btn-secondary btn-small">ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ</button>
            </div>
          </div>
          <div id="toast" class="toast"></div>
        </div>
      </div>

      <!-- äºˆç´„ä¸€è¦§ãƒ»çµã‚Šè¾¼ã¿ -->
      <div class="card">
        <div class="card-header">
          ğŸ“… äºˆç´„ä¸€è¦§ãƒ»çµã‚Šè¾¼ã¿
        </div>
        <div class="card-body">
          <div class="filters">
            <div class="form-group">
              <label>ğŸ“† æœŸé–“</label>
              <div class="date-range-wrapper">
                <input type="date" id="from">
                <span class="date-separator">ã€œ</span>
                <input type="date" id="to">
              </div>
            </div>
            <div class="form-group">
              <label>ğŸ’³ æ”¯æ‰•æ–¹æ³•</label>
              <select id="pay">
                <option value="">ã™ã¹ã¦</option>
                <option value="cash">ç¾é‡‘</option>
                <option value="paypay">PayPay</option>
              </select>
            </div>
            <div class="form-group">
              <label>ğŸ“Š çŠ¶æ…‹</label>
              <select id="st">
                <option value="">ã™ã¹ã¦</option>
                <option value="reserved">äºˆç´„æ¸ˆã¿</option>
                <option value="picked">å¼•æ¸¡æ¸ˆã¿</option>
                <option value="canceled">å–æ¶ˆæ¸ˆã¿</option>
              </select>
            </div>
          </div>
          
          <div class="filter-actions">
            <button id="search" class="btn btn-primary">ğŸ” æ¤œç´¢</button>
            <button id="csv" class="btn btn-success">ğŸ“Š CSVå‡ºåŠ›</button>
          </div>

          <div class="table-container mt-3">
            <table id="tbl">
              <thead>
                <tr>
                  <th>ğŸ“… æ—¥æ™‚</th>
                  <th>ğŸ”¢ ç•ªå·</th>
                  <th>ğŸ‘¤ é¡§å®¢</th>
                  <th>ğŸ’° åˆè¨ˆ</th>
                  <th>ğŸ’³ æ”¯æ‰•</th>
                  <th>ğŸ“Š çŠ¶æ…‹</th>
                  <th>âš™ï¸ æ“ä½œ</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- å•†å“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
      <div class="card">
        <div class="card-header">
          ğŸ›ï¸ å•†å“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†
        </div>
        <div class="card-body">
          <div class="products-table-container">
            <table class="products-table">
              <thead>
                <tr>
                  <th style="width: 30%;">ğŸ“¦ å•†å“å</th>
                  <th style="width: 15%;">ğŸ’° é‡‘é¡</th>
                  <th style="width: 12%;">âœ… è²©å£²å¯å¦</th>
                  <th style="width: 12%;">ğŸŒ¸ å­£ç¯€å•†å“</th>
                  <th style="width: 12%;">ğŸ“Š åœ¨åº«æ•°</th>
                  <th style="width: 19%;">âš™ï¸ æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="products"></tbody>
            </table>
          </div>
          <button id="addProduct" class="btn btn-primary">â• å•†å“è¿½åŠ </button>
        </div>
      </div>

      <!-- è‡¨æ™‚ä¼‘æ¥­ -->
      <div class="card">
        <div class="card-header">
          ğŸš« è‡¨æ™‚ä¼‘æ¥­ç®¡ç†
        </div>
        <div class="card-body">
          <div class="holiday-form">
            <div class="form-group" style="flex: 1;">
              <label>ğŸ“… ä¼‘æ¥­æ—¥</label>
              <input type="date" id="hdate">
            </div>
            <div class="form-group" style="flex: 2;">
              <label>ğŸ“ ç†ç”±</label>
              <input placeholder="ä¼‘æ¥­ç†ç”±ã‚’å…¥åŠ›" id="hreason">
            </div>
            <button id="hadd" class="btn btn-primary">â• ç™»éŒ²</button>
          </div>
          <ul id="hlist" class="holiday-list"></ul>
        </div>
      </div>
    </section>
  </div>

  <!-- Firebase Web SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script>
  // â˜…å¿…ãšã‚ãªãŸã®å€¤ã«ç½®æ›ï¼ˆäºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ã¨åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼‰
  const firebaseConfig = {
    apiKey: "AIzaSyC7e6YZSeh1RYBdWEfob6xT7XnxBIZu2Uw",
    authDomain: "hyggelyreservationsystem.firebaseapp.com",
    projectId: "hyggelyreservationsystem",
    storageBucket: "hyggelyreservationsystem.firebasestorage.app",
    messagingSenderId: "549459143900",
    appId: "1:549459143900:web:7d9f2bb6ddc22573869819"
  };
  
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // DOMè¦ç´ ã®å®‰å…¨ãªå–å¾—é–¢æ•°
  function safeGetElement(id) {
    const element = document.getElementById(id);
    if (!element) {
      console.warn(`è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${id}`);
      return null;
    }
    return element;
  }

  function safeQuerySelector(selector) {
    const element = document.querySelector(selector);
    if (!element) {
      console.warn(`è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${selector}`);
      return null;
    }
    return element;
  }

  // è¦ç´ å‚ç…§ï¼ˆå®‰å…¨ãªå–å¾—ï¼‰
  const el = {
    authBox: safeGetElement('auth'),
    app: safeGetElement('app'),
    email: safeGetElement('email'),
    pass: safeGetElement('pass'),
    login: safeGetElement('login'),
    signout: safeGetElement('signout'),
    toast: safeGetElement('toast'),
    pid: safeGetElement('pid'),
    uemail: safeGetElement('uemail'),
    adminPill: safeGetElement('adminPill'),
    from: safeGetElement('from'),
    to: safeGetElement('to'),
    pay: safeGetElement('pay'),
    st: safeGetElement('st'),
    tblBody: safeQuerySelector('#tbl tbody'),
    search: safeGetElement('search'),
    csv: safeGetElement('csv'),
    productsHost: safeGetElement('products'),
    addProduct: safeGetElement('addProduct'),
    hdate: safeGetElement('hdate'),
    hreason: safeGetElement('hreason'),
    hadd: safeGetElement('hadd'),
    hlist: safeGetElement('hlist')
  };

  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  function toast(msg, ok = false) {
    if (!el.toast) {
      console.log('[TOAST]', msg);
      return;
    }
    el.toast.textContent = msg;
    el.toast.className = 'toast ' + (ok ? 'ok' : 'err');
    el.toast.style.display = 'block';
    setTimeout(() => { 
      if (el.toast) el.toast.style.display = 'none'; 
    }, 5000);
    console.log('[INFO]', msg);
  }
  
  function n(v, d = 0) { 
    const x = Number(v); 
    return isNaN(x) ? d : x; 
  }

  // æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆsettings/adminsï¼‰
  async function checkAdmin(email) {
    try {
      const snap = await db.collection('settings').doc('admins').get();
      const list = (snap.exists && Array.isArray(snap.data().emails)) ? snap.data().emails : [];
      const ok = !!email && list.includes(email);
      
      if (el.adminPill) {
        el.adminPill.textContent = ok ? 'OK' : 'NG';
        el.adminPill.className = 'pill ' + (ok ? 'ok' : 'ng');
      }
      
      if (!snap.exists) toast('è­¦å‘Š: settings/admins ãŒæœªä½œæˆã€‚C3ã®æ‰‹é †ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚');
      return ok;
    } catch (e) {
      if (el.adminPill) {
        el.adminPill.textContent = 'ERR';
        el.adminPill.className = 'pill ng';
      }
      toast('ç®¡ç†è€…ãƒªã‚¹ãƒˆå–å¾—ã«å¤±æ•—: ' + (e.message || e), false);
      return false;
    }
  }

  // ã‚µã‚¤ãƒ³ã‚¤ãƒ³ï¼ã‚¢ã‚¦ãƒˆ
  if (el.login) {
    el.login.onclick = async () => {
      try {
        if (!el.email || !el.pass) {
          toast('å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', false);
          return;
        }
        await auth.signInWithEmailAndPassword(el.email.value.trim(), el.pass.value);
      } catch (e) {
        toast('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: ' + (e.message || e), false);
      }
    };
  }
  
  if (el.signout) {
    el.signout.onclick = async () => {
      try { 
        await auth.signOut(); 
      } catch (e) { 
        toast('ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆå¤±æ•—: ' + (e.message || e), false); 
      }
    };
  }

  // çŠ¶æ…‹é·ç§»
  auth.onAuthStateChanged(async (u) => {
    const signed = !!u;
    
    if (el.authBox) el.authBox.style.display = signed ? 'none' : 'block';
    if (el.app) el.app.classList.toggle('hidden', !signed);
    
    if (signed) {
      if (el.pid) el.pid.textContent = firebase.app().options.projectId || '(unknown)';
      if (el.uemail) el.uemail.textContent = u.email || '(no email)';
      
      const isAdmin = await checkAdmin(u.email || '');
      
      try {
        await Promise.all([
          loadReservations().catch(e => console.error('äºˆç´„ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', e)),
          loadProducts().catch(e => console.error('å•†å“ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', e)),
          loadHolidays().catch(e => console.error('ä¼‘æ¥­æ—¥ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', e))
        ]);
        
        if (!isAdmin) {
          toast('ç¾åœ¨ã®ãƒ­ã‚°ã‚¤ãƒ³ã¯ç®¡ç†æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ›¸ãè¾¼ã¿æ“ä½œã¯å¤±æ•—ã—ã¾ã™ã€‚', false);
        } else {
          toast('ãƒ­ã‚°ã‚¤ãƒ³ãŒå®Œäº†ã—ã¾ã—ãŸ', true);
        }
      } catch (e) {
        toast('åˆæœŸãƒ­ãƒ¼ãƒ‰ã§ã‚¨ãƒ©ãƒ¼: ' + (e.message || e), false);
      }
    } else {
      if (el.pid) el.pid.textContent = '-';
      if (el.uemail) el.uemail.textContent = '-';
      if (el.adminPill) {
        el.adminPill.textContent = 'â€”';
        el.adminPill.className = 'pill neutral';
      }
    }
  });

  // äºˆç´„ä¸€è¦§
  async function loadReservations() {
    try {
      if (!el.from || !el.to || !el.pay || !el.st || !el.tblBody) {
        console.warn('äºˆç´„ä¸€è¦§ã®è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }

      let ref = db.collection('reservations')
        .where('pickup_date', '>=', el.from.value || '2000-01-01')
        .where('pickup_date', '<=', el.to.value || '2100-12-31');
      
      if (el.pay.value) ref = ref.where('payment_method', '==', el.pay.value);
      if (el.st.value) ref = ref.where('status', '==', el.st.value);
      
      const snap = await ref.orderBy('pickup_date').orderBy('pickup_time').limit(500).get();
      el.tblBody.innerHTML = '';
      
      snap.forEach(doc => {
        const r = doc.data();
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.pickup_date} ${r.pickup_time}</td>
          <td>${r.reserve_no || doc.id.slice(0, 7)}</td>
          <td>${r.customer?.name || ''}</td>
          <td>Â¥${(r.total || 0).toLocaleString()}</td>
          <td>${r.payment_method}</td>
          <td><span class="pill ${getStatusClass(r.status)}">${getStatusText(r.status)}</span></td>
          <td>
            <div class="action-buttons">
              <button data-id="${doc.id}" class="btn btn-success btn-small pick">âœ… å¼•æ¸¡æ¸ˆ</button>
              <button data-id="${doc.id}" class="btn btn-danger btn-small cancel">âŒ å–æ¶ˆ</button>
            </div>
          </td>`;
        el.tblBody.appendChild(tr);
      });
      
      el.tblBody.querySelectorAll('.pick').forEach(b => 
        b.onclick = () => updateStatus(b.dataset.id, 'picked').catch(e => toast('æ›´æ–°å¤±æ•—: ' + (e.message || e), false))
      );
      el.tblBody.querySelectorAll('.cancel').forEach(b => 
        b.onclick = () => updateStatus(b.dataset.id, 'canceled').catch(e => toast('æ›´æ–°å¤±æ•—: ' + (e.message || e), false))
      );
    } catch (e) {
      console.error('äºˆç´„ä¸€è¦§ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', e);
      toast('äºˆç´„ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (e.message || e), false);
    }
  }

  function getStatusClass(status) {
    switch (status) {
      case 'picked': return 'ok';
      case 'canceled': return 'ng';
      default: return 'neutral';
    }
  }

  function getStatusText(status) {
    switch (status) {
      case 'reserved': return 'äºˆç´„æ¸ˆã¿';
      case 'picked': return 'å¼•æ¸¡æ¸ˆã¿';
      case 'canceled': return 'å–æ¶ˆæ¸ˆã¿';
      default: return status;
    }
  }

  if (el.search) {
    el.search.onclick = () => loadReservations().catch(e => toast('æ¤œç´¢å¤±æ•—: ' + (e.message || e), false));
  }

  async function updateStatus(id, status) {
    try {
      await db.collection('reservations').doc(id).update({ status });
      await loadReservations();
      toast(`çŠ¶æ…‹ã‚’ ${getStatusText(status)} ã«æ›´æ–°ã—ã¾ã—ãŸ`, true);
    } catch (e) {
      toast('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (e.message || e), false);
    }
  }

  // CSVï¼ˆUTF-8 BOMï¼‰
  if (el.csv) {
    el.csv.onclick = () => {
      try {
        const rows = [['æ—¥æ™‚', 'ç•ªå·', 'é¡§å®¢', 'åˆè¨ˆ', 'æ”¯æ‰•', 'çŠ¶æ…‹']];
        const tableRows = document.querySelectorAll('#tbl tbody tr');
        
        tableRows.forEach(tr => {
          const cells = [...tr.children].slice(0, 6).map(td => td.textContent.replace(/[Â¥,]/g, '').trim());
          rows.push(cells);
        });
        
        const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
        const csv = rows.map(r => r.map(c => `"${String(c).replace(/"/g, '""')}"`).join(',')).join('\n');
        const blob = new Blob([bom, csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob); 
        a.download = 'reservations.csv'; 
        a.click();
        toast('CSVã‚’ç”Ÿæˆã—ã¾ã—ãŸ', true);
      } catch (e) { 
        toast('CSVç”Ÿæˆå¤±æ•—: ' + (e.message || e), false); 
      }
    };
  }

  // å•†å“ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  async function loadProducts() {
    try {
      if (!el.productsHost) {
        console.warn('å•†å“ãƒ›ã‚¹ãƒˆè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }

      const snap = await db.collection('products').orderBy('sort_order').get();
      el.productsHost.innerHTML = '';
      
      snap.forEach(doc => {
        const p = doc.data();
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>
            <input value="${p.name || ''}" class="product-input nm" placeholder="å•†å“åã‚’å…¥åŠ›">
          </td>
          <td>
            <input type="number" value="${n(p.price, 0)}" class="product-input pr" placeholder="0" min="0">
          </td>
          <td>
            <div class="product-checkbox-wrapper">
              <input type="checkbox" class="product-checkbox en" ${p.enabled ? 'checked' : ''}>
              <label class="product-checkbox-label">æœ‰åŠ¹</label>
            </div>
          </td>
          <td>
            <div class="product-checkbox-wrapper">
              <input type="checkbox" class="product-checkbox sn" ${p.seasonal ? 'checked' : ''}>
              <label class="product-checkbox-label">å­£ç¯€</label>
            </div>
          </td>
          <td>
            <input type="number" value="${n(p.sort_order, 0)}" class="product-input so" placeholder="0" min="0">
          </td>
          <td>
            <div class="product-actions">
              <button class="product-btn product-btn-save save">ğŸ’¾ ä¿å­˜</button>
              <button class="product-btn product-btn-delete del">ğŸ—‘ï¸ å‰Šé™¤</button>
            </div>
          </td>
        `;
        el.productsHost.appendChild(row);
        
        const saveBtn = row.querySelector('.save');
        const delBtn = row.querySelector('.del');
        
        if (saveBtn) {
          saveBtn.onclick = async () => {
            try {
              const nameInput = row.querySelector('.nm');
              const priceInput = row.querySelector('.pr');
              const enabledInput = row.querySelector('.en');
              const seasonalInput = row.querySelector('.sn');
              const stockInput = row.querySelector('.so');
              
              if (!nameInput || !priceInput || !enabledInput || !seasonalInput || !stockInput) {
                toast('å•†å“ãƒ•ã‚©ãƒ¼ãƒ ã®è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', false);
                return;
              }
              
              await db.collection('products').doc(doc.id).update({
                name: nameInput.value.trim(),
                price: n(priceInput.value, 0),
                enabled: enabledInput.checked,
                seasonal: seasonalInput.checked,
                sort_order: n(stockInput.value, 0)
              });
              await loadProducts();
              toast('å•†å“ã‚’ä¿å­˜ã—ã¾ã—ãŸ', true);
            } catch (e) { 
              toast('å•†å“ä¿å­˜å¤±æ•—: ' + (e.message || e), false); 
            }
          };
        }
        
        if (delBtn) {
          delBtn.onclick = async () => {
            if (confirm('ã“ã®å•†å“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
              try { 
                await db.collection('products').doc(doc.id).delete(); 
                await loadProducts(); 
                toast('å•†å“ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', true); 
              } catch (e) { 
                toast('å•†å“å‰Šé™¤å¤±æ•—: ' + (e.message || e), false); 
              }
            }
          };
        }
      });
    } catch (e) {
      console.error('å•†å“ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', e);
      toast('å•†å“ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (e.message || e), false);
    }
  }
  
  if (el.addProduct) {
    el.addProduct.onclick = async () => {
      try {
        await db.collection('products').add({
          name: 'æ–°å•†å“', 
          price: 0, 
          enabled: true, 
          seasonal: false, 
          sort_order: 0
        });
        await loadProducts();
        toast('å•†å“ã‚’è¿½åŠ ã—ã¾ã—ãŸ', true);
      } catch (e) { 
        toast('å•†å“è¿½åŠ å¤±æ•—: ' + (e.message || e), false); 
      }
    };
  }

  // è‡¨æ™‚ä¼‘æ¥­
  async function loadHolidays() {
    try {
      if (!el.hlist) {
        console.warn('ä¼‘æ¥­æ—¥ãƒªã‚¹ãƒˆè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }

      const snap = await db.collection('holidays').orderBy('date').limit(365).get();
      el.hlist.innerHTML = '';
      
      snap.forEach(doc => {
        const h = doc.data();
        const li = document.createElement('li');
        li.className = 'holiday-item';
        li.innerHTML = `
          <span>ğŸ“… ${h.date} - ${h.reason || 'ç†ç”±æœªè¨˜è¼‰'}</span>
          <button class="btn btn-danger btn-small">ğŸ—‘ï¸ å‰Šé™¤</button>
        `;
        
        const delBtn = li.querySelector('button');
        if (delBtn) {
          delBtn.onclick = async () => {
            if (confirm('ã“ã®ä¼‘æ¥­æ—¥ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
              try { 
                await db.collection('holidays').doc(doc.id).delete(); 
                await loadHolidays(); 
                toast('ä¼‘æ¥­æ—¥ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', true); 
              } catch (e) { 
                toast('ä¼‘æ¥­æ—¥å‰Šé™¤å¤±æ•—: ' + (e.message || e), false); 
              }
            }
          };
        }
        
        el.hlist.appendChild(li);
      });
    } catch (e) {
      console.error('ä¼‘æ¥­æ—¥ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', e);
      toast('ä¼‘æ¥­æ—¥ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (e.message || e), false);
    }
  }
  
  if (el.hadd) {
    el.hadd.onclick = async () => {
      try {
        if (!el.hdate || !el.hreason) {
          toast('ä¼‘æ¥­æ—¥ãƒ•ã‚©ãƒ¼ãƒ ã®è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', false);
          return;
        }
        
        const d = el.hdate.value?.trim(); 
        const r = el.hreason.value?.trim();
        
        if (!d) { 
          toast('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„', false); 
          return; 
        }
        
        await db.collection('holidays').add({ date: d, reason: r || '' });
        el.hdate.value = ''; 
        el.hreason.value = '';
        await loadHolidays();
        toast('ä¼‘æ¥­æ—¥ã‚’ç™»éŒ²ã—ã¾ã—ãŸ', true);
      } catch (e) { 
        toast('ä¼‘æ¥­ç™»éŒ²å¤±æ•—: ' + (e.message || e), false); 
      }
    };
  }
  </script>
</body>
</html>