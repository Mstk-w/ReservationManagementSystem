<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ã‚«ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥äºˆç´„ï¼ˆç°¡ç´ ç‰ˆï¼‰</title>
    <style>
      /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒï¼ˆçœç•¥ï¼‰ */
      body {
        font-family: system-ui, sans-serif;
        background: #f4f1ed;
        margin: 0;
        line-height: 1.6;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      label {
        display: block;
        margin-bottom: 1rem;
      }
      input, select {
        width: 100%;
        padding: 8px;
        margin-top: 4px;
        box-sizing: border-box;
      }
      button {
        background: #ff9b21;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 10px 20px;
        cursor: pointer;
      }
      button:hover {
        background: #e0881c;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
      }
      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #333;
        color: #fff;
        padding: 10px 20px;
        border-radius: 4px;
        display: none;
        z-index: 1000;
      }
      .toast.success { background: #38a169; }
      .toast.error { background: #e53e3e; }
      .back-to-top {
        position: fixed;
        bottom: 20px;
        left: 20px;
        display: none;
        background: #ff9b21;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
        cursor: pointer;
      }
    </style>
    </head>
<body>
  <main class="container">
    <div id="reservationForm">
      <h1>ğŸ ã‚«ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥å—å–äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </h1>

      <!-- Web3.0Formsçµ±åˆãƒ•ã‚©ãƒ¼ãƒ  -->
      <form id="reservationForm" data-web3forms-key="15433c4c-2f75-48a4-ad16-f191f511b77e">
        <section>
          <h2>ğŸ“… å—å–æ—¥æ™‚ã®é¸æŠ</h2>
          <label>å—å–æ—¥ï¼ˆæ°´ãƒ»åœŸã®ã¿ï¼‰<span style="color: #e53e3e;">*</span>
            <input type="date" name="pickup_date" id="pickupDate" required />
          </label>
          
          <label>å—å–æ™‚é–“ï¼ˆ11:00â€“17:00ï¼‰<span style="color: #e53e3e;">*</span>
            <select name="pickup_time" id="pickupTime" required>
              <option value="">æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </label>
          
          <label>æ”¯æ‰•æ–¹æ³•<span style="color: #e53e3e;">*</span>
            <select name="payment_method" id="paymentMethod" required>
              <option value="cash">ğŸ’° ç¾é‡‘</option>
              <option value="paypay">ğŸ“± PayPay</option>
            </select>
          </label>
        </section>

        <section>
          <h2>ğŸ›’ å•†å“ã‚’é¸æŠ</h2>
          <div id="productList" class="grid"></div>
          <div class="total">åˆè¨ˆ: Â¥<span id="total">0</span></div>
          <input type="hidden" name="order_items" id="orderItems" />
          <input type="hidden" name="total_amount" id="totalAmount" />
        </section>

        <section>
          <h2>ğŸ‘¤ ãŠå®¢æ§˜æƒ…å ±</h2>
          <label>ãŠåå‰<span style="color: #e53e3e;">*</span>
            <input name="customer_name" id="custName" placeholder="å±±ç”°å¤ªéƒ" required />
          </label>
          
          <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<span style="color: #e53e3e;">*</span>
            <input name="email" id="custEmail" type="email" placeholder="taro@example.com" required />
          </label>
          
          <label>é›»è©±ç•ªå·ï¼ˆä»»æ„ï¼‰
            <input name="phone" id="custPhone" type="tel" placeholder="090-1234-5678" />
          </label>
        </section>

        <button type="submit">ğŸ“ äºˆç´„ã‚’ç¢ºå®šã™ã‚‹</button>
        <input type="hidden" name="_next" value="https://yoursite.com/success.html">
      </form>
    </div>
    </main>
    <div id="toast" class="toast"></div>
    <button id="backToTop" class="back-to-top" aria-label="ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸æˆ»ã‚‹">â–²</button>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script>
    // Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyC7e6YZSeh1RYBdWEfob6xT7XnxBIZu2Uw",
      authDomain: "hyggelyreservationsystem.firebaseapp.com",
      projectId: "hyggelyreservationsystem",
      storageBucket: "hyggelyreservationsystem.firebasestorage.app",
      messagingSenderId: "549459143900",
      appId: "1:549459143900:web:7d9f2bb6ddc22573869819"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let products = [];
    let cart = {};
    let holidays = new Set();

    // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
    async function init() {
      try {
        console.log('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹');
        
        await Promise.all([
          loadProducts(),
          loadHolidays()
        ]);
        
        setupEventListeners();
        showToast('ã‚·ã‚¹ãƒ†ãƒ ã®æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã”äºˆç´„ã‚’ãŠé€²ã‚ãã ã•ã„ã€‚', 'success');
        
        console.log('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
      } catch (error) {
        console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
        showToast(`ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      }
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    function setupEventListeners() {
      console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šé–‹å§‹');
      
      // å—å–æ—¥å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
      const pickupDate = document.getElementById('pickupDate');
      if (pickupDate) {
        pickupDate.addEventListener('change', handleDateChange);
        console.log('å—å–æ—¥ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');
      }

      // æ”¯æ‰•æ–¹æ³•å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
      const paymentMethod = document.getElementById('paymentMethod');
      if (paymentMethod) {
        paymentMethod.addEventListener('change', calculateTotal);
        console.log('æ”¯æ‰•æ–¹æ³•ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');
      }
      
      console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');
    }

    // å•†å“èª­ã¿è¾¼ã¿
    async function loadProducts() {
      try {
        console.log('å•†å“ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
        
        const snapshot = await db.collection('products')
          .where('enabled', '==', true)
          .orderBy('sort_order')
          .get();
        
        products = [];
        snapshot.forEach(doc => {
          products.push({ id: doc.id, ...doc.data() });
        });
        
        console.log(`å•†å“ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†: ${products.length}ä»¶`);
        renderProducts();
        
      } catch (error) {
        console.error('å•†å“èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        throw error;
      }
    }

    // ä¼‘æ¥­æ—¥èª­ã¿è¾¼ã¿
    async function loadHolidays() {
      try {
        console.log('ä¼‘æ¥­æ—¥ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
        
        const snapshot = await db.collection('holidays').get();
        holidays.clear();
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.date) holidays.add(data.date);
        });
        
        console.log(`ä¼‘æ¥­æ—¥ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†: ${holidays.size}ä»¶`);
        
      } catch (error) {
        console.warn('ä¼‘æ¥­æ—¥èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼ˆç¶™ç¶šï¼‰:', error);
        // ä¼‘æ¥­æ—¥å–å¾—å¤±æ•—ã¯è‡´å‘½çš„ã§ã¯ãªã„ã®ã§ç¶šè¡Œ
      }
    }

    // å•†å“è¡¨ç¤º
    function renderProducts() {
      const productList = document.getElementById('productList');
      if (!productList) {
        console.error('å•†å“ãƒªã‚¹ãƒˆè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }
      
      productList.innerHTML = '';
      
      if (products.length === 0) {
        productList.innerHTML = '<p>å•†å“ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }
      
      products.forEach(product => {
        if (product.price <= 0) {
          console.log(`ä¾¡æ ¼0å††å•†å“ã‚’ã‚¹ã‚­ãƒƒãƒ—: ${product.name}`);
          return;
        }
        
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>ğŸ ${escapeHtml(product.name)}</h3>
          <div>Â¥${product.price.toLocaleString()}</div>
          <label>æ•°é‡ 
            <input type="number" min="0" max="20" value="0" class="qty" data-id="${product.id}" onchange="updateQuantity(this)">
          </label>
        `;
        productList.appendChild(card);
      });
      
      console.log(`å•†å“ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºå®Œäº†: ${products.length}ä»¶`);
    }

    // å—å–æ—¥å¤‰æ›´å‡¦ç†
    function handleDateChange() {
      const selectedDate = document.getElementById('pickupDate').value;
      const timeSelect = document.getElementById('pickupTime');
      const timeHelp = document.getElementById('timeHelp');
      
      console.log('å—å–æ—¥å¤‰æ›´:', selectedDate);
      
      if (!timeSelect || !timeHelp) {
        console.error('æ™‚é–“é¸æŠè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }
      
      timeSelect.innerHTML = '<option value="">æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
      
      if (!selectedDate) {
        timeHelp.textContent = 'å…ˆã«å—å–æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„';
        timeHelp.style.color = '#718096';
        return;
      }
      
      if (!isBusinessDay(selectedDate)) {
        timeHelp.textContent = 'âŒ å–¶æ¥­æ—¥ï¼ˆæ°´ãƒ»åœŸï¼‰ã‹ã¤è‡¨æ™‚ä¼‘æ¥­æ—¥ä»¥å¤–ã‚’é¸æŠã—ã¦ãã ã•ã„';
        timeHelp.style.color = '#e53e3e';
        showToast('å–¶æ¥­æ—¥ï¼ˆæ°´æ›œæ—¥ãƒ»åœŸæ›œæ—¥ï¼‰ã‹ã¤è‡¨æ™‚ä¼‘æ¥­æ—¥ä»¥å¤–ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      // æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆç”Ÿæˆï¼ˆ11:00-17:00ã€30åˆ†åˆ»ã¿ï¼‰
      const slots = generateTimeSlots();
      slots.forEach(slot => {
        const option = document.createElement('option');
        option.value = slot;
        option.textContent = slot;
        timeSelect.appendChild(option);
      });
      
      timeHelp.textContent = 'âœ… å—å–æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„';
      timeHelp.style.color = '#38a169';
      
      console.log(`æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆç”Ÿæˆå®Œäº†: ${slots.length}å€‹`);
    }

    // å–¶æ¥­æ—¥åˆ¤å®š
    function isBusinessDay(dateStr) {
      try {
        const date = new Date(dateStr + 'T00:00:00+09:00');
        const dayOfWeek = date.getDay();
        
        if (holidays.has(dateStr)) {
          console.log(`${dateStr} ã¯è‡¨æ™‚ä¼‘æ¥­æ—¥`);
          return false;
        }
        
        const isBusiness = dayOfWeek === 3 || dayOfWeek === 6; // æ°´æ›œæ—¥ã¾ãŸã¯åœŸæ›œæ—¥
        console.log(`${dateStr} æ›œæ—¥:${dayOfWeek} å–¶æ¥­æ—¥:${isBusiness}`);
        return isBusiness;
        
      } catch (error) {
        console.error('å–¶æ¥­æ—¥åˆ¤å®šã‚¨ãƒ©ãƒ¼:', error);
        return false;
      }
    }

    // æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆç”Ÿæˆ
    function generateTimeSlots(start = "11:00", end = "17:00", interval = 30) {
      try {
        const [startH, startM] = start.split(':').map(Number);
        const [endH, endM] = end.split(':').map(Number);
        const startMinutes = startH * 60 + startM;
        const endMinutes = endH * 60 + endM;
        
        const slots = [];
        for (let minutes = startMinutes; minutes <= endMinutes; minutes += interval) {
          const hours = String(Math.floor(minutes / 60)).padStart(2, '0');
          const mins = String(minutes % 60).padStart(2, '0');
          slots.push(`${hours}:${mins}`);
        }
        
        return slots;
      } catch (error) {
        console.error('æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
        return [];
      }
    }

    // æ•°é‡å¤‰æ›´
    function updateQuantity(input) {
      try {
        const productId = input.dataset.id;
        const quantity = Math.max(0, Math.min(20, Number(input.value || 0)));
        
        input.value = quantity;
        
        if (quantity === 0) {
          delete cart[productId];
        } else {
          cart[productId] = quantity;
        }
        
        calculateTotal();
        console.log(`å•†å“æ•°é‡å¤‰æ›´: ${productId} = ${quantity}`);
        
      } catch (error) {
        console.error('æ•°é‡å¤‰æ›´ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // åˆè¨ˆè¨ˆç®—
    function calculateTotal() {
      try {
        let totalAmount = 0;
        let itemCount = 0;
        
        Object.entries(cart).forEach(([productId, quantity]) => {
          const product = products.find(p => p.id === productId);
          if (product) {
            totalAmount += product.price * quantity;
            itemCount += quantity;
          }
        });
        
        const totalEl = document.getElementById('total');
        if (totalEl) {
          totalEl.textContent = totalAmount.toLocaleString();
        }
        
        console.log(`åˆè¨ˆè¨ˆç®—: Â¥${totalAmount.toLocaleString()} (${itemCount}ç‚¹)`);
        return totalAmount;
        
      } catch (error) {
        console.error('åˆè¨ˆè¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
        return 0;
      }
    }

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
    async function handleSubmit() {
      try {
        console.log('äºˆç´„é€ä¿¡å‡¦ç†é–‹å§‹');
        
        // ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
        const submitBtn = document.getElementById('submitBtn');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = 'å‡¦ç†ä¸­...';
        }
        
        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        validateForm();
        
        // äºˆç´„ãƒ‡ãƒ¼ã‚¿ä½œæˆ
        const orderItems = Object.entries(cart).map(([productId, quantity]) => {
          const product = products.find(p => p.id === productId);
          return {
            product_id: productId,
            name: product.name,
            unit_price: product.price,
            qty: quantity,
            line_total: product.price * quantity
          };
        });
        
        const totalAmount = calculateTotal();
        
        const reservationData = {
          items: orderItems,
          subtotal: totalAmount,
          total: totalAmount,
          payment_method: document.getElementById('paymentMethod').value,
          pickup_date: document.getElementById('pickupDate').value,
          pickup_time: document.getElementById('pickupTime').value,
          pickup_ts: firebase.firestore.Timestamp.fromDate(
            new Date(`${document.getElementById('pickupDate').value}T${document.getElementById('pickupTime').value}:00+09:00`)
          ),
          status: 'reserved',
          customer: {
            name: document.getElementById('custName').value.trim(),
            email: document.getElementById('custEmail').value.trim(),
            phone: document.getElementById('custPhone').value.trim() || null
          },
          notes: document.getElementById('notes').value.trim() || null,
          created_at: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        console.log('äºˆç´„ãƒ‡ãƒ¼ã‚¿:', reservationData);
        
        // Firestoreä¿å­˜
        const docRef = await db.collection('reservations').add(reservationData);
        const reserveNo = `R-${reservationData.pickup_date.replace(/-/g,'')}-${docRef.id.slice(0,5)}`;
        await docRef.update({ reserve_no: reserveNo });
        
        console.log(`äºˆç´„ä¿å­˜å®Œäº†: ${reserveNo}`);
        
        // æˆåŠŸç”»é¢è¡¨ç¤º
        showSuccessScreen({
          reserveNo: reserveNo,
          customerName: reservationData.customer.name,
          pickupDate: reservationData.pickup_date,
          pickupTime: reservationData.pickup_time,
          paymentMethod: reservationData.payment_method === 'cash' ? 'ç¾é‡‘' : 'PayPay',
          totalAmount: totalAmount.toLocaleString()
        });
        
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        resetForm();
        
      } catch (error) {
        console.error('äºˆç´„ã‚¨ãƒ©ãƒ¼:', error);
        showToast(`äºˆç´„ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      } finally {
        // ãƒœã‚¿ãƒ³å¾©æ—§
        const submitBtn = document.getElementById('submitBtn');
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = 'ğŸ“ äºˆç´„ã‚’ç¢ºå®šã™ã‚‹';
        }
      }
    }

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    function validateForm() {
      const pickupDate = document.getElementById('pickupDate').value;
      const pickupTime = document.getElementById('pickupTime').value;
      const custName = document.getElementById('custName').value.trim();
      const custEmail = document.getElementById('custEmail').value.trim();
      
      if (!pickupDate || !isBusinessDay(pickupDate)) {
        throw new Error('æœ‰åŠ¹ãªå—å–æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
      }
      
      if (!pickupTime) {
        throw new Error('å—å–æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„');
      }
      
      if (!custName) {
        throw new Error('ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      }
      
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(custEmail)) {
        throw new Error('æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      }
      
      if (Object.keys(cart).length === 0) {
        throw new Error('å•†å“ã‚’1ç‚¹ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„');
      }
      
      const now = new Date();
      const pickupDateTime = new Date(`${pickupDate}T${pickupTime}:00+09:00`);
      if (pickupDateTime <= now) {
        throw new Error('éå»ã®æ—¥æ™‚ã¯é¸æŠã§ãã¾ã›ã‚“');
      }
      
      console.log('ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ');
    }

    // æˆåŠŸç”»é¢è¡¨ç¤º
    function showSuccessScreen(data) {
      const elements = {
        reserveNo: document.getElementById('successReserveNo'),
        name: document.getElementById('successName'),
        dateTime: document.getElementById('successDateTime'),
        payment: document.getElementById('successPayment'),
        total: document.getElementById('successTotal')
      };
      
      if (elements.reserveNo) elements.reserveNo.textContent = data.reserveNo;
      if (elements.name) elements.name.textContent = data.customerName;
      if (elements.dateTime) elements.dateTime.textContent = `${data.pickupDate} ${data.pickupTime}`;
      if (elements.payment) elements.payment.textContent = data.paymentMethod;
      if (elements.total) elements.total.textContent = `Â¥${data.totalAmount}`;
      
      const formEl = document.getElementById('reservationForm');
      const successEl = document.getElementById('successScreen');
      
      if (formEl) formEl.classList.add('hidden');
      if (successEl) successEl.style.display = 'block';
      
      window.scrollTo(0, 0);
      console.log('æˆåŠŸç”»é¢è¡¨ç¤ºå®Œäº†');
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ ã«æˆ»ã‚‹
    function backToForm() {
      const formEl = document.getElementById('reservationForm');
      const successEl = document.getElementById('successScreen');
      
      if (successEl) successEl.style.display = 'none';
      if (formEl) formEl.classList.remove('hidden');
      
      window.scrollTo(0, 0);
      console.log('ãƒ•ã‚©ãƒ¼ãƒ ç”»é¢ã«å¾©å¸°');
    }

    // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
    function resetForm() {
      try {
        cart = {};
        
        // æ•°é‡ãƒªã‚»ãƒƒãƒˆ
        document.querySelectorAll('.qty').forEach(input => {
          input.value = 0;
        });
        calculateTotal();
        
        // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¯ãƒªã‚¢
        const fields = ['pickupDate', 'custName', 'custEmail', 'custPhone', 'notes'];
        fields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field) field.value = '';
        });
        
        // æ™‚é–“é¸æŠãƒªã‚»ãƒƒãƒˆ
        const timeSelect = document.getElementById('pickupTime');
        if (timeSelect) {
          timeSelect.innerHTML = '<option value="">æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
        }
        
        // æ”¯æ‰•æ–¹æ³•ãƒªã‚»ãƒƒãƒˆ
        const paymentMethod = document.getElementById('paymentMethod');
        if (paymentMethod) {
          paymentMethod.value = 'cash';
        }
        
        console.log('ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆå®Œäº†');
        
      } catch (error) {
        console.error('ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
    function showToast(message, type = 'success', duration = 5000) {
      const toast = document.getElementById('toast');
      if (!toast) {
        console.warn('ãƒˆãƒ¼ã‚¹ãƒˆè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }
      
      toast.textContent = message;
      toast.className = `toast ${type}`;
      toast.style.display = 'block';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, duration);
      
      console.log(`ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º: ${message} (${type})`);
    }

    // ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸æˆ»ã‚‹ãƒœã‚¿ãƒ³
    function setupBackToTop() {
      const btn = document.getElementById('backToTop');
      if (!btn) return;
      window.addEventListener('scroll', () => {
        btn.style.display = window.scrollY > 200 ? 'block' : 'none';
      });
      btn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // åˆæœŸåŒ–å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOMèª­ã¿è¾¼ã¿å®Œäº†ã€åˆæœŸåŒ–é–‹å§‹');
      init().catch(error => {
        console.error('åˆæœŸåŒ–å¤±æ•—:', error);
        showToast(`ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      });
      setupBackToTop();
    });
</script>
</body>
</html>