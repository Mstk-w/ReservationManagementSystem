<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ã‚«ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥ç®¡ç†ç”»é¢ï¼ˆç°¡ç´ ç‰ˆï¼‰</title>
  <style>
    /* ç®¡ç†ç”»é¢ç”¨ã®ç°¡ç´ ãªã‚¹ã‚¿ã‚¤ãƒ« */
    body { font-family: system-ui; margin: 20px; }
    .container { max-width: 1200px; margin: 0 auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
    button { padding: 8px 16px; margin: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“Š ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
    
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ -->
    <div id="loginSection">
      <input type="email" id="email" placeholder="ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«">
      <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
      <button onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>

    <!-- ç®¡ç†ç”»é¢ -->
    <div id="adminPanel" style="display:none">
      <h2>äºˆç´„ä¸€è¦§</h2>
      <table id="reservationsTable">
        <thead>
          <tr>
            <th>äºˆç´„ç•ªå·</th>
            <th>æ—¥æ™‚</th>
            <th>é¡§å®¢</th>
            <th>åˆè¨ˆ</th>
            <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      
      <button onclick="loadReservations()">ğŸ”„ æ›´æ–°</button>
      <button onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script>
    // Firebaseè¨­å®šï¼ˆæ—¢å­˜ã¨åŒã˜ï¼‰
    const firebaseConfig = { 
  apiKey: "AIzaSyC7e6YZSeh1RYBdWEfob6xT7XnxBIZu2Uw",
  authDomain: "hyggelyreservationsystem.firebaseapp.com",
  projectId: "hyggelyreservationsystem",
  storageBucket: "hyggelyreservationsystem.firebasestorage.app",
  messagingSenderId: "549459143900",
  appId: "1:549459143900:web:7d9f2bb6ddc22573869819"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // èªè¨¼çŠ¶æ…‹ç›£è¦–
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadReservations();
      } else {
        document.getElementById('loginSection').style.display = 'block';
        document.getElementById('adminPanel').style.display = 'none';
      }
    });

    // ãƒ­ã‚°ã‚¤ãƒ³
    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        await auth.signInWithEmailAndPassword(email, password);
      } catch (error) {
        alert('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: ' + error.message);
      }
    }

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
    function logout() {
      auth.signOut();
    }

    // äºˆç´„ä¸€è¦§èª­ã¿è¾¼ã¿
    async function loadReservations() {
      const snapshot = await db.collection('reservations')
        .orderBy('created_at', 'desc')
        .limit(50)
        .get();
      
      const tbody = document.querySelector('#reservationsTable tbody');
      tbody.innerHTML = '';
      
      snapshot.forEach(doc => {
        const data = doc.data();
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${data.reserve_no || doc.id.slice(0,8)}</td>
          <td>${data.pickup_date} ${data.pickup_time}</td>
          <td>${data.customer?.name}</td>
          <td>Â¥${data.total?.toLocaleString()}</td>
          <td>${data.status}</td>
          <td>
            <button onclick="updateStatus('${doc.id}', 'picked')">å¼•æ¸¡æ¸ˆ</button>
            <button onclick="updateStatus('${doc.id}', 'canceled')">å–æ¶ˆ</button>
          </td>
        `;
      });
    }

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
    async function updateStatus(docId, status) {
      try {
        await db.collection('reservations').doc(docId).update({ status });
        loadReservations();
        alert('æ›´æ–°ã—ã¾ã—ãŸ');
      } catch (error) {
        alert('æ›´æ–°ã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    }
  </script>
</body>
</html>